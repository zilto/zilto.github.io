"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2871],{1777:e=>{e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"/2024/10/26/setup-taskwarrior-server","metadata":{"permalink":"/til/2024/10/26/setup-taskwarrior-server","source":"@site/til/2024-10-26-setup-taskwarrior-server/index.md","title":"Setting up Taskwarrior 3.0 server","description":"Taskwarrior is a command line tool to manage tasks. I used it daily with its Timewarrior integration to track time spent on tasks and projects.","date":"2024-10-26T00:00:00.000Z","tags":[],"readingTime":3.705,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false},"content":"Taskwarrior is a command line tool to manage tasks. I used it daily with its Timewarrior integration to track time spent on tasks and projects.\\n\\nThis post shares my journey upgrading to Taskwarrior 3 and setting up the sync server. I\'ll had the most details possible to help anyone else looking to do the same.\\n\\n## Some context\\n\\nI mostly use Taskwarrior from my desktop machine, but I also use it on my laptop when traveling or working from a coffee shop. At home, I have a low-power computer running at all times, hosting several services, including the Taskwarrior sync server. \\n\\n## Upgrade to Taskwarrior 3\\n\\nAs of today, the official Taskwarrior documentation points to [these instructions](https://github.com/GothenburgBitFactory/taskwarrior/blob/develop/doc/devel/contrib/development.md). The steps are:\\n\\n1. Back up existing Taskwarrior data (`<3.0`)\\n\\n    ```bash\\n    task export > ~/taskwarrior-backup.json\\n    ```\\n\\n2. install the requirements (CMake, Rust, etc.)\\n3. download and extract the release, and move to the project directory\\n\\n    ```bash\\n    wget https://github.com/GothenburgBitFactory/taskwarrior/releases/download/v3.1.0/task-3.1.0.tar.gz\\n    tar xzvf task-3.1.0.tar.gz\\n    cd task-3.1.0\\n    ```\\n\\n4. build the `task` executable\\n\\n    ```bash\\n    cmake -S . -B build -DCMAKE_BUILD_TYPE=Release\\n    cmake --build build --target task_executable\\n    ```\\n\\n5. install the project\\n\\n    ```bash\\n    sudo cmake --install build\\n    ```\\n\\n6. Check your installation\\n\\n    ```bash\\n    task version\\n    ```\\n\\n7. restore the data from your backup\\n\\n    ```bash\\n    task import rc.hooks=0 ~/taskwarrior-backup.json\\n    ```\\n\\n## Deploy server container\\n\\nThe server is available through the [TaskChampion Sync-Server repository](https://github.com/GothenburgBitFactory/taskchampion-sync-server). The `README` gives good instructions on how to use the provided `Dockerfile` to build the image and run the container locally. One thing you might miss is the [Packages section](https://github.com/GothenburgBitFactory/taskchampion-sync-server/pkgs/container/taskchampion-sync-server), which hosts pre-built images on GitHub container registry.\\n\\nIn my case, I want to run the server on [Portainer](https://www.portainer.io/) which adds some steps and considerations that I\'ll detail.\\n\\n1. Under `Volumes`, add a new volume for your Taskwarrior data\\n2. Under `Containers`, add a new container\\n    \\n    1. Set the container name\\n    2. For the registry, select advanced mode and paste the container image URL from the [Packages section](https://github.com/GothenburgBitFactory/taskchampion-sync-server/pkgs/container/taskchampion-sync-server). For example: \\n        \\n        ```\\n        ghcr.io/gothenburgbitfactory/taskchampion-sync-server:main\\n        ```\\n    3. Manual configure a host port to the container port 8080. Remember this port for your client configuration.\\n    4. Map the host volume defined in Portainer to the container\'s defined volume. This is hardcoded in the image and is currently\\n    \\n        ```\\n        /var/lib/taskchampion-sync-server\\n        ```\\n    5. Deploy the container\\n\\n\\n## Configure the client\\n\\nNow that your server is running, you need to configure your client, which must be using Taskwarrior `>=3.0`. Minimally, you have to set the server URL and the client id. This can be done via `task config`.\\n\\nThe `$HOST` is the hostname or IP of your server, in this case the Portainer host.\\n\\nThe `$PORT` must match the host port of your container. In version `<3.1`, the config is `sync.server.origin`, but in version `>=3.1`, the config is `sync.server.url`\\n\\n```bash\\ntask config sync.server.url http://$HOST:$PORT\\n```\\n\\nThe `$CLIENT_ID` should uniquely identify a client. A UUID or a cryptographic hash is ideal. You will need to set this client id on all clients that connect to the same Taskwarrior data (e.g., desktop, laptop, phone). By using different client ids, you can have multiple users on the server or keep Taskwarrior data isolated.\\n\\n```bash\\ntask config sync.server.client_id $CLIENT_ID\\n```\\n\\n(Optional) Set the `$ENCRYPTION_SECRET` to encrypt the data on the server. You will need to set this secret on all clients that connect to the same Taskwarrior data.\\n\\n> NOTE. The config path is `sync.` instead of `sync.server.`\\n```bash\\ntask config sync.encryption_secret $ENCRYPTION_SECRET\\n```\\n\\nTo check your installation, run this command and voil\xe0!\\n\\n```bash\\ntask sync\\n```\\n\\nNow, set the same client configuration on your other devices (`url`, `client_id`, `encryption_secret`) and they should all be in sync. \\n\\n### Configure via `.taskrc`\\n\\nAlso, note that you can directly configure the client via the `.taskrc` file. The `task config` command simply sets values there. This can be an effective solution to set up multiple clients.\\n```bash\\nnano ~/.taskrc\\n```\\n\\n```nano\\n# Here is an example of entries that use the default, override and blank values\\n#   variable=foo   -- By specifying a value, this overrides the default\\n#   variable=      -- By specifying no value, this means no default\\n#   #variable=foo  -- By commenting out the line, or deleting it, this uses the default\\n\\nsync.server.client_id=...\\nsync.encryption_secret=...\\nsync.server.url=...\\n```\\n\\n## Next steps\\n\\n- Automate client syncing\\n    - Use Linux\'s `cron` feature ([reference](https://www.redhat.com/en/blog/linux-cron-command))\\n    - Use Taskwarrior hooks ([reference](https://taskwarrior.org/docs/hooks2/))\\n- Set up Timewarrior integration on all clients ([reference](https://timewarrior.net/docs/taskwarrior/))\\n    - Note. The clients need Timewarrior to generate time entries, but the Taskwarrior server does not need Timewarrior."}]}}')}}]);