<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">The perks of creating dataflows with Hamilton | More is more</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tjean.me/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tjean.me/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tjean.me/blog/perks-of-hamilton"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="The perks of creating dataflows with Hamilton | More is more"><meta data-rh="true" name="description" content="Hamilton is an open-source Python microframework developed at Stitch Fix. It automagically organizes Python functions into a directed acyclic graph (DAG) from their name and type annotations. It was originally created to facilitate working with tabular datasets containing hundreds of columns, but it’s general enough to enable many data science or machine learning (ML) scenarios."><meta data-rh="true" property="og:description" content="Hamilton is an open-source Python microframework developed at Stitch Fix. It automagically organizes Python functions into a directed acyclic graph (DAG) from their name and type annotations. It was originally created to facilitate working with tabular datasets containing hundreds of columns, but it’s general enough to enable many data science or machine learning (ML) scenarios."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-08-08T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/zilto"><meta data-rh="true" property="article:tag" content="Hamilton"><link data-rh="true" rel="icon" href="/img/icon.png"><link data-rh="true" rel="canonical" href="https://tjean.me/blog/perks-of-hamilton"><link data-rh="true" rel="alternate" href="https://tjean.me/blog/perks-of-hamilton" hreflang="en"><link data-rh="true" rel="alternate" href="https://tjean.me/blog/perks-of-hamilton" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://tjean.me/blog/perks-of-hamilton","mainEntityOfPage":"https://tjean.me/blog/perks-of-hamilton","url":"https://tjean.me/blog/perks-of-hamilton","headline":"The perks of creating dataflows with Hamilton","name":"The perks of creating dataflows with Hamilton","description":"Hamilton is an open-source Python microframework developed at Stitch Fix. It automagically organizes Python functions into a directed acyclic graph (DAG) from their name and type annotations. It was originally created to facilitate working with tabular datasets containing hundreds of columns, but it’s general enough to enable many data science or machine learning (ML) scenarios.","datePublished":"2022-08-08T00:00:00.000Z","author":{"@type":"Person","name":"Thierry Jean","url":"https://github.com/zilto","image":"https://github.com/zilto.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://tjean.me/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="MoreIsMore RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="MoreIsMore Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="MoreIsMore JSON Feed">




<link rel="alternate" type="application/rss+xml" href="/til/rss.xml" title="Today I Learned RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/til/atom.xml" title="Today I Learned Atom Feed">
<link rel="alternate" type="application/json" href="/til/feed.json" title="Today I Learned JSON Feed"><link rel="stylesheet" href="/assets/css/styles.17e17681.css">
<script src="/assets/js/runtime~main.c4d326ec.js" defer="defer"></script>
<script src="/assets/js/main.8797ddc8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">More is more</b></a><a class="navbar__item navbar__link" href="/docs/category/personal-projects">Portfolio</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/til">TIL</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/thierry-jean/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Let&#x27;s connect<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/rag">Retrieval augmented generation (RAG) with Streamlit, FastAPI, Weaviate, and Hamilton!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/pdf-summarizer">Containerized PDF Summarizer with FastAPI and Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/feast-hamilton">Featurization: Integrating Hamilton with Feast</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/prefect-hamilton">Simplify Prefect Workflow Creation and Maintenance with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/modular-llm">Building a maintainable and modular LLM application stack with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/airflow-hamilton">Simplify Airflow DAG Creation and Maintenance with Hamilton</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/perks-of-hamilton">The perks of creating dataflows with Hamilton</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">The perks of creating dataflows with Hamilton</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-08-08T00:00:00.000Z">August 8, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/zilto.png" alt="Thierry Jean"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Thierry Jean</span></a></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><a href="https://github.com/stitchfix/hamilton" target="_blank" rel="noopener noreferrer">Hamilton</a> is an open-source Python microframework developed at <a href="https://www.stitchfix.com/" target="_blank" rel="noopener noreferrer">Stitch Fix</a>. It automagically organizes Python functions into a <em>directed acyclic graph</em> (DAG) from their name and type annotations. It was originally created to facilitate working with tabular datasets containing hundreds of columns, but it’s general enough to enable many data science or machine learning (ML) scenarios.</p>
<blockquote>
<p>crosspost from <a href="https://medium.com/@thijean/the-perks-of-creating-dataflows-with-hamilton-36e8c56dd2a" target="_blank" rel="noopener noreferrer">https://medium.com/@thijean/the-perks-of-creating-dataflows-with-hamilton-36e8c56dd2a</a></p>
</blockquote>
<p>Over the last year, I used Hamilton both in academic research to build forecast models from smartphone sensor data, and in industry to implement dynamic bidding strategies for an ad exchange. Amongst a sea of awesome open-source tools, Hamilton happened to neatly suit my needs. Below, I will give a brief overview of Hamilton, and break down what I believe to be its key strengths:</p>
<ol>
<li>Improve code readability</li>
<li>Facilitate reproducible pipelines</li>
<li>Enable faster iteration cycles</li>
<li>Reduce the development-production gap</li>
</ol>
<p>To learn more about the design and the development of the framework, the <a href="https://multithreaded.stitchfix.com/blog/" target="_blank" rel="noopener noreferrer">Stitch Fix’s engineering blog</a> is a gold mine.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-introduction-to-hamilton">Quick introduction to Hamilton<a href="#quick-introduction-to-hamilton" class="hash-link" aria-label="Direct link to Quick introduction to Hamilton" title="Direct link to Quick introduction to Hamilton">​</a></h2>
<p>Hamilton relies on 3 main components: the <em>functions</em>, the <em>driver</em>, and the <em>desired outputs</em>.</p>
<p><em>Functions</em> are your regular Python functions, but each needs to have a unique name and type annotated inputs and outputs, and be defined within a Python module (.py file).</p>
<p>One or more modules are passed to the <em>driver</em> along a configuration object. The driver builds a DAG by linking a function’s arguments (named and annotated) to other functions’ name. At this point, no computation has happened yet.</p>
<p><img decoding="async" loading="lazy" alt="Alt text" src="/assets/images/image-546b423881f98909147206416b8aa782.png" width="1037" height="682" class="img_ev3q"></p>
<p>Finally, a list of <em>desired outputs</em>, which can be any node from the graph, is passed to the driver. When <em>executed</em>, the driver computes the desired output by running only the necessary functions. By default, Hamilton outputs pandas dataframe, but it can also return a dictionary containing arbitrary objects.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="suggested-development-workflow">Suggested development workflow<a href="#suggested-development-workflow" class="hash-link" aria-label="Direct link to Suggested development workflow" title="Direct link to Suggested development workflow">​</a></h2>
<p>My preferred development workflow relies on opening side-to-side a Python module and a Jupyter notebook with the <a href="https://ipython.org/ipython-doc/3/config/extensions/autoreload.html" target="_blank" rel="noopener noreferrer">%autoreload ipython magic</a> configured (code snippet below). I write my data transformation in the module, and in the notebook, I instantiate a Hamilton driver and test the DAG with a small subset of data. Because of <code>%autoreload</code>, the module is reimported with the latest changes each time the Hamilton DAG is executed. This approach prevents out-of-order notebook executions, and functions always reside in clean .py files.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> hamilton</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">driver </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> my_module  </span><span class="token comment" style="color:#999988;font-style:italic"># data transformation module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">load_ext autoreload   </span><span class="token comment" style="color:#999988;font-style:italic"># load extension</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">autoreload </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># configure autoreload to only affect specified files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">aimport my_module  </span><span class="token comment" style="color:#999988;font-style:italic"># specify my_module to be reloaded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hamilton_driver </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Driver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> my_module</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hamilton_driver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;desired_output1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;desired_output2&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="improve-code-readability">Improve code readability<a href="#improve-code-readability" class="hash-link" aria-label="Direct link to Improve code readability" title="Direct link to Improve code readability">​</a></h2>
<blockquote>
<p>Zen of Python #7: Readability counts</p>
</blockquote>
<p>Code readability is multifaceted, but can be summarized to making code easy to understand for colleagues, reviewers, and your future self. You may think that your pandas operations are self-evident, or that writing a separate function for 1–3 lines of numpy code is overkill, <strong>but you’re likely wrong</strong>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">avg_3wk_spend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Rolling 3 week average spend.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> spend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rolling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">spend_per_signup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> signups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;The cost per signup in relation to spend.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> spend </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> signups</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Simply by requiring unique function names and type annotations, Hamilton pushes developers to divide the pipeline into steps that each hold their own <strong>intent</strong>. It generates a <strong>semantic layer</strong> that is decoupled from the data transformation implementation. In the above example, the name <code>avg_3wk_spend</code> and the docstring communicate a clear intent compared to the pandas code <code>spend.rolling(3).mean()</code> (note that the time unit couldn’t be inferred!) Communicating the intent or the business purpose of a function helps understand the broader pipeline, but also allows collaborators to improve or replace a given implementation while preserving the intent.</p>
<p>Breaking down complex functions into simpler single-purpose functions has many other benefits. For one, abstracting repetitive or redundant operations makes your code <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank" rel="noopener noreferrer">DRY</a>-er and easier to unit test and debug. Also, meaningful results become more clearly separated from intermediary transformations. Utility functions to view the computation graph diagram can be helpful during the development process.</p>
<p><img decoding="async" loading="lazy" alt="Alt text" src="/assets/images/image-1-de0e4d5ca2f03b8c4b82906475014bb9.png" width="1400" height="685" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="facilitate-reproducible-pipeline">Facilitate reproducible pipeline<a href="#facilitate-reproducible-pipeline" class="hash-link" aria-label="Direct link to Facilitate reproducible pipeline" title="Direct link to Facilitate reproducible pipeline">​</a></h2>
<p>Both in academia and in industry, data science and ML projects generate a myriad of results and artifacts. <em>Experiment tracking</em> typically refers to the systematic and organized tracking of those artifacts. It’s most often discussed in the context of ML training and hyperparameter optimization, leaving out data transformation pipelines despite their influence on the former.</p>
<p>With Hamilton, the end-to-end transformations can be tracked from a few parameters. Since the Hamilton DAG is built in a deterministic manner, it doesn’t have to be logged; only the functions it’s built need to. No large artifacts have to be created! When running experiments with your favorite tool (MLFlow, Weights&amp;biases, etc.), simply log the Hamilton <strong>driver configuration</strong> and the <strong>Git SHA1</strong> of your python modules. To go a step further, you can store a <strong>picture of the executed DAG</strong> and track the <strong>package version</strong> in case of future behavior change.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> hamilton</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">driver </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time_transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> location_transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connection</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;database&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:memory:&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># required driver config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hamilton_driver </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Driver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> time_transform</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> location_transform</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># view the complete computation DAG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hamilton_driver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">display_all_functions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./file.dot&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># view only the path to the specified outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hamilton_driver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">visualize_execution</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;period_of_day&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;location_jump_speed&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./file.dot&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Alt text" src="/assets/images/image-2-98cbabbde819e68d86b0c6f9bd2ff376.png" width="1400" height="1111" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-faster-iteration-cycles">Enable faster iteration cycles<a href="#enable-faster-iteration-cycles" class="hash-link" aria-label="Direct link to Enable faster iteration cycles" title="Direct link to Enable faster iteration cycles">​</a></h2>
<p>Many “DAG-based” frameworks (Airflow, Metaflow, flyte, Prefect, etc.) are gaining traction in the data science and ML community. However, most are intended for orchestration, which is broader than the data transformation problem Hamilton aims to solve. It remains non-trivial to identify frameworks that align with your needs, have a simple, clear and well-documented API, require minimal <a href="https://en.wikipedia.org/wiki/Glue_code" target="_blank" rel="noopener noreferrer">glue code</a>, and are easy to move away from.</p>
<p>Orchestration frameworks rely on first defining processing steps, and then manually connecting them into a DAG. Connections have to be specified through decorators, classes, functions, or even YAML configuration files. Such approach imposes mental burden on data scientists and forces them to rewrite the DAG every time they want to investigate a new hypothesis. The problem only worsens as a project scales in complexity. Because this process is error-prone, a lot of time can be spent wrestling with the framework. Automatically building the DAG can lead to productivity improvements.</p>
<p>Relying on regular Python functions, Hamilton requires minimal refactoring to get started (a <a href="https://hamilton-docs.gitbook.io/docs/best-practices/migrating-to-hamilton" target="_blank" rel="noopener noreferrer">robust migration</a> guide is available). This allows adopters to make “quick wins  ” and eases the onboarding of colleagues. For complex scenarios, powerful features are accessible through function <a href="https://hamilton-docs.gitbook.io/docs/reference/api-reference/available-decorators" target="_blank" rel="noopener noreferrer">decorators</a>. In all cases, your code remains usable outside of Hamilton (minus the decorators).</p>
<blockquote>
<p><strong>Aside</strong>: On the opposite end of the spectrum, I worked with <a href="https://kedro.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">Kedro</a> which is a holistic and opinionated framework for data pipelines, and had a positive experience. It can feel restrictive at times, but the built-in conventions and the extensive set of tools it provides (i.e., configuration, versioning, tests, notebooks, etc.) does improve team productivity and solution robustness.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reduce-the-development-production-gap">Reduce the development-production gap<a href="#reduce-the-development-production-gap" class="hash-link" aria-label="Direct link to Reduce the development-production gap" title="Direct link to Reduce the development-production gap">​</a></h2>
<p>While Hamilton is a great framework for iterations, how does it fair in production? It might work for Stitch Fix, but can it handle my specific business use case? Is it computationally efficient? The TL;DR. is yes!</p>
<p>In Hamilton, the driver receives the DAG instructions and later executes the computation. Originally, it relied on the pandas library to calculate new columns, which can <a href="https://pandas.pydata.org/docs/user_guide/scale.html" target="_blank" rel="noopener noreferrer">become inefficient at scale</a>. An exciting addition was the release of <a href="https://multithreaded.stitchfix.com/blog/2022/02/22/scaling-hamilton/" target="_blank" rel="noopener noreferrer">Spark, Dask, and Ray</a> drivers. Now, pandas data transformation can be executed by the Hamilton Dask driver and get the performance increase for free. It allows data scientists to define and test functions locally, and move to production without refactoring. What’s not to love!</p>
<p>Recently, <a href="https://multithreaded.stitchfix.com/blog/2022/07/26/hamilton-data-quality/" target="_blank" rel="noopener noreferrer">data validation</a> at the node level and support for the <a href="https://pandera.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">pandera</a> library (another great lightweight package!) were added. The development team is actively improving integration with open source tools. For advanced users, it’s possible to extend the framework’s standard interfaces (driver, decorator, result builder, etc.) to meet your requirements. People at Stitch Fix are very responsive and eager to help through <a href="https://github.com/stitchfix/hamilton/issues" target="_blank" rel="noopener noreferrer">GitHub issues</a> and their <a href="https://join.slack.com/t/hamilton-opensource/shared_invite/zt-1bjs72asx-wcUTgH7q7QX1igiQ5bbdcg" target="_blank" rel="noopener noreferrer">Slack channel</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Hamilton is a great tool for data scientists and ML folks. I hope the overview provided convinced you to give it a try. You’re only <code>pip install sf-hamilton</code> away from getting started!</p>
<p>References:</p>
<ol>
<li>Hamilton GitHub page (2022), <a href="https://github.com/stitchfix/hamilton" target="_blank" rel="noopener noreferrer">https://github.com/stitchfix/hamilton</a></li>
<li>Stich Fix engineering blog (2022), <a href="https://multithreaded.stitchfix.com/engineering/" target="_blank" rel="noopener noreferrer">https://multithreaded.stitchfix.com/engineering/</a></li>
</ol></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/hamilton">Hamilton</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/airflow-hamilton"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Simplify Airflow DAG Creation and Maintenance with Hamilton</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quick-introduction-to-hamilton" class="table-of-contents__link toc-highlight">Quick introduction to Hamilton</a></li><li><a href="#suggested-development-workflow" class="table-of-contents__link toc-highlight">Suggested development workflow</a></li><li><a href="#improve-code-readability" class="table-of-contents__link toc-highlight">Improve code readability</a></li><li><a href="#facilitate-reproducible-pipeline" class="table-of-contents__link toc-highlight">Facilitate reproducible pipeline</a></li><li><a href="#enable-faster-iteration-cycles" class="table-of-contents__link toc-highlight">Enable faster iteration cycles</a></li><li><a href="#reduce-the-development-production-gap" class="table-of-contents__link toc-highlight">Reduce the development-production gap</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© Copyright 2024, Thierry Jean. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>