<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Containerized PDF Summarizer with FastAPI and Hamilton | More is more</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zilto.github.io/personal_website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://zilto.github.io/personal_website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://zilto.github.io/personal_website/blog/pdf-summarizer"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Containerized PDF Summarizer with FastAPI and Hamilton | More is more"><meta data-rh="true" name="description" content="Skip learning convoluted LLM-specific frameworks and write your first LLM application using regular Python functions and Hamilton! In this post, we’ll present a containerized PDF summarizer powered by the OpenAI API. Its flow is encoded in Hamilton, which the FastAPI backend runs and exposes as an inference endpoint. The lightweight frontend uses Streamlit and exercises the backend. (GitHub repo)"><meta data-rh="true" property="og:description" content="Skip learning convoluted LLM-specific frameworks and write your first LLM application using regular Python functions and Hamilton! In this post, we’ll present a containerized PDF summarizer powered by the OpenAI API. Its flow is encoded in Hamilton, which the FastAPI backend runs and exposes as an inference endpoint. The lightweight frontend uses Streamlit and exercises the backend. (GitHub repo)"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-18T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/zilto"><meta data-rh="true" property="article:tag" content="Hamilton,OpenAI,LLM,FastAPI,Docker"><link data-rh="true" rel="icon" href="/personal_website/img/icon.png"><link data-rh="true" rel="canonical" href="https://zilto.github.io/personal_website/blog/pdf-summarizer"><link data-rh="true" rel="alternate" href="https://zilto.github.io/personal_website/blog/pdf-summarizer" hreflang="en"><link data-rh="true" rel="alternate" href="https://zilto.github.io/personal_website/blog/pdf-summarizer" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/personal_website/blog/rss.xml" title="MoreIsMore RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/personal_website/blog/atom.xml" title="MoreIsMore Atom Feed">
<link rel="alternate" type="application/json" href="/personal_website/blog/feed.json" title="MoreIsMore JSON Feed"><link rel="stylesheet" href="/personal_website/assets/css/styles.e01dfa2e.css">
<script src="/personal_website/assets/js/runtime~main.bb6063f8.js" defer="defer"></script>
<script src="/personal_website/assets/js/main.27b89429.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/personal_website/"><div class="navbar__logo"><img src="/personal_website/img/icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/personal_website/img/icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">More is more</b></a><a class="navbar__item navbar__link" href="/personal_website/docs/category/personal-projects">Portfolio</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/personal_website/blog">Blog</a><a class="navbar__item navbar__link" href="/personal_website/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/thierry-jean/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Let&#x27;s connect<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/rag">Retrieval augmented generation (RAG) with Streamlit, FastAPI, Weaviate, and Hamilton!</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/personal_website/blog/pdf-summarizer">Containerized PDF Summarizer with FastAPI and Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/feast-hamilton">Featurization: Integrating Hamilton with Feast</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/prefect-hamilton">Simplify Prefect Workflow Creation and Maintenance with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/modular-llm">Building a maintainable and modular LLM application stack with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/airflow-hamilton">Simplify Airflow DAG Creation and Maintenance with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/perks-of-hamilton">The perks of creating dataflows with Hamilton</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Skip learning convoluted LLM-specific frameworks and write your first LLM application using regular Python functions and Hamilton! In this post, we’ll present a containerized PDF summarizer powered by the OpenAI API. Its flow is encoded in Hamilton, which the FastAPI backend runs and exposes as an inference endpoint. The lightweight frontend uses Streamlit and exercises the backend. (GitHub repo)"><header><h1 class="title_f1Hy" itemprop="headline">Containerized PDF Summarizer with FastAPI and Hamilton</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-18T00:00:00.000Z" itemprop="datePublished">August 18, 2023</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zilto.png" alt="Thierry Jean" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Thierry Jean</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Skip learning convoluted LLM-specific frameworks and write your first LLM application using regular Python functions and <a href="https://github.com/dagWorks-Inc/hamilton" target="_blank" rel="noopener noreferrer">Hamilton</a>! In this post, we’ll present a containerized PDF summarizer powered by the <a href="https://platform.openai.com/docs/api-reference" target="_blank" rel="noopener noreferrer">OpenAI API</a>. Its flow is encoded in Hamilton, which the <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noopener noreferrer">FastAPI</a> backend runs and exposes as an inference endpoint. The lightweight frontend uses <a href="https://docs.streamlit.io/" target="_blank" rel="noopener noreferrer">Streamlit</a> and exercises the backend. (<a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/LLM_Workflows/pdf_summarizer" target="_blank" rel="noopener noreferrer">GitHub repo</a>)</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-8afd5b643e3596877a57c4549fba352b.png" width="975" height="646" class="img_ev3q"></p>
<blockquote>
<p>crosspost from <a href="https://blog.dagworks.io/p/containerized-pdf-summarizer-with" target="_blank" rel="noopener noreferrer">https://blog.dagworks.io/p/containerized-pdf-summarizer-with</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-first-generation-of-large-language-models-applications">The first generation of large language models applications<a href="#the-first-generation-of-large-language-models-applications" class="hash-link" aria-label="Direct link to The first generation of large language models applications" title="Direct link to The first generation of large language models applications">​</a></h2>
<p>Large language models (LLMs) open up new opportunities to exploit unstructured text data and ways to interact with the computer, such as chat-based information retrieval, writing assistance, or text summarization. These models can complete many different tasks that need to be specified via a text prompt. This flexibility in terms of input and output differs from previous ML/AI initiatives in industry (e.g., forecasting, recommender systems, computer vision) that had precisely defined inputs and outputs formats. It is one of the central <a href="https://huyenchip.com/2023/04/11/llm-engineering.html" target="_blank" rel="noopener noreferrer">challenges and complexities</a> introduced by LLMs, and furthers the need for traceability and validation steps for data pipelines.</p>
<p>Accordingly, the tooling to solve these problems is nascent and changes rapidly. Not only is the best development paradigm undefined, it is a moving target since LLMs themselves are evolving. Building an application using LLMs today will almost certainly lead to dealing with breaking changes or migrations around the LLM APIs, prompt versioning, context management, storage infrastructure (e.g., vector databases), monitoring frameworks, and other service vendors.</p>
<p>In their current state, the available LLM frameworks might get you up and running, but are missing the modularity and the transparency required for a proper software development lifecycle that considers production operations.</p>
<ul>
<li>How do you iterate &amp; test the behavior of new prompts and version them?</li>
<li>Do you version your prompt with the code &amp; LLM used? How coupled are they?</li>
<li>How do you run your workflows in a batch setting without a web-server?</li>
<li>How do you monitor your system’s performance and data artifacts produced without slowing down your development cycle?</li>
<li>How do you structure a readable codebase that facilitates collaboration and allows you to understand the impacts of changes on your various workflows?</li>
</ul>
<p>We’ll explore through a series of posts how to overcome these challenges when adding LLM capabilities into your application. In this article, we ground the discussion around a PDF summarizer and future posts will extend the example with testing, Spark support, lineage, etc. <strong>Subscribe to get updates as we publish them</strong>!</p>
<h1>Introducing Hamilton</h1>
<p>LLMs-based applications can be expressed as <a href="https://en.wikipedia.org/wiki/Dataflow_programming" target="_blank" rel="noopener noreferrer">dataflows</a>, which boils down to modeling your program by focusing on the moving of data artifacts (prompts, context, knowledge base, generated response, etc.) with computation (what you do with the data).</p>
<p><a href="https://github.com/dagWorks-Inc/hamilton" target="_blank" rel="noopener noreferrer">Hamilton</a> is a declarative micro-framework to describe dataflows in Python. Its strength is expressing the flow of data and computation in a straightforward and easy to maintain manner (much like dbt does for SQL). It has minimal dependencies and can run anywhere Python runs, meaning the same code will work in development notebooks, scripts, Spark clusters, or production web-services. Hamilton is not a new framework (3.5+ years old), and has been used for years in production modeling data &amp; machine learning dataflows.</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-1-6b730d286b040562659cc780fc12a680.png" width="1037" height="682" class="img_ev3q"></p>
<p>The picture above encapsulates the function-centric declarative approach of Hamilton. The function’s name is tied to its outputs and its arguments define what data it depends on. This allows Hamilton to read functions found in a module and automatically generate the DAG to be executed. This paradigm incentivizes developers to write small modular functions instead of scripts or larger functions, without sacrificing iteration speed. As a result, it is easier to:</p>
<ul>
<li>Read and understand the codebase</li>
<li>Edit implementations and extend your business logic</li>
<li>Do data validation after key steps</li>
<li>Understand downstream consequences of changes</li>
<li>Unit test and prevent breaking changes</li>
<li>Reuse functions or groups of functions across projects</li>
<li>Add in platform concerns independent of the logic encoded with Hamilton.</li>
</ul>
<p>Again, to keep this post short and focused, we won’t dive into how to do all the above.</p>
<blockquote>
<p>If you have never tried Hamilton, feel free to visit our interactive browser demo at: <a href="https://www.tryhamilton.dev/" target="_blank" rel="noopener noreferrer">https://www.tryhamilton.dev/</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hamilton-for-llm-and-nlp-flows">Hamilton for LLM and NLP flows<a href="#hamilton-for-llm-and-nlp-flows" class="hash-link" aria-label="Direct link to Hamilton for LLM and NLP flows" title="Direct link to Hamilton for LLM and NLP flows">​</a></h2>
<p>Given the rapid progress in the LLM and tooling space, adopting a low abstraction framework like Hamilton for your application facilitates writing a modular and well-tested codebase, as well as a straightforward approach to versioning flows. Having your focus on modularity early on will facilitate future upgrades and migrations, and allow you to keep up with state-of-the-art without breaking production.</p>
<p>For LLM applications, being able to reuse code logic between development (e.g. notebooks, scripts) and production services (FastAPI, serverless services, Spark) has a large positive impact on development speed. Also, Hamilton decouples your LLM dataflow logic from your service/platform concerns. For example, the caching of OpenAI requests, application scaling, or monitoring, are platform concerns and should be separated as such. This decoupling is also helpful in a hand-off model if you operate in one; data scientists work on Hamilton modeling logic while engineers handle ensuring it runs with the appropriate monitoring in production. As you read this post, we invite you to think about how the code we show might develop and evolve in your organization – leave us a comment afterwards with your thoughts/reactions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-a-modular-pdf-summarizer-application">Building a modular PDF summarizer application<a href="#building-a-modular-pdf-summarizer-application" class="hash-link" aria-label="Direct link to Building a modular PDF summarizer application" title="Direct link to Building a modular PDF summarizer application">​</a></h2>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-2-820b7941404ea8a723889fc61be177ea.png" width="961" height="461" class="img_ev3q"></p>
<p>At the core, the application loads a PDF as text, chunks it, and calls the <a href="https://platform.openai.com/docs/api-reference" target="_blank" rel="noopener noreferrer">OpenAI API</a> to summarize the chunks and reduces them into a single summary. It is packaged as a frontend and a backend container using docker-compose. The frontend uses <a href="https://docs.streamlit.io/" target="_blank" rel="noopener noreferrer">Streamlit</a>, a library to write web UI using Python. When clicking on the <code>Summarize</code> button (see introduction image), an <code>HTTP POST</code> request <code>/summarize_sync</code> is made to the FastAPI backend. <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noopener noreferrer">FastAPI</a> is a library to create REST API endpoints to communicate with a server. When receiving the <code>/summarize_sync</code> request, the endpoint executes the relevant operation via an Hamilton driver instantiated on the server.</p>
<blockquote>
<p><a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/LLM_Workflows/pdf_summarizer" target="_blank" rel="noopener noreferrer">Find the code on GitHub</a></p>
</blockquote>
<p>First, let’s look at the directory structure:</p>
<div class="language-title=&quot;Directory language-title=&quot;directory codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-title=&quot;directory codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── docker-compose.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── server.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── summarization.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── app.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>At a high-level, the frontend and the backend are in separate folders, each with their own <code>Dockerfile</code> and <code>requirements.txt</code>. The backend has <code>server.py</code> which contains the FastAPI endpoints definition and the calls to the Hamilton driver, while <code>summarization.py</code> contains the dataflow logic used by the <code>Hamilton Driver</code>. If you’re coming from LangChain, you can think of <code>summarization.py</code> as the implementation of a more <a href="https://python.langchain.com/docs/modules/chains/" target="_blank" rel="noopener noreferrer">modular chain</a>. The directory structure should feel natural and intuitive, making it easy to understand for any junior colleague joining your team.</p>
<hr>
<p>Now, let’s look at snippets of <code>summarization.py</code> and then <code>server.py</code> powering the backend:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Hamilton dataflows</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># summarization.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ... imports </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">summarize_chunk_of_text_prompt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;an academic paper&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Base prompt for summarizing chunks of text.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Summarize this text from </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_type</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">. Extract any key points with reasoning.\n\nContent:&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">summarize_text_from_summaries_prompt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;an academic paper&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Prompt for summarizing a paper from a list of summaries.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;&quot;&quot;Write a summary collated from this collection of key points extracted from </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_type</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">    The summary should highlight the core argument, conclusions and evidence, and answer the user&#x27;s query.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">    User query: {{query}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">    The summary should be structured in bulleted lists following the headings Core Argument, Evidence, and Conclusions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">    Key points:\n{{results}}\nSummary:\n&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@config</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">when</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;pdf&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">raw_text__pdf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pdf_source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> tempfile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SpooledTemporaryFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Takes a filepath to a PDF and returns a string of the PDF&#x27;s contents</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param pdf_source: Series of filepaths to PDFs</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return: Series of strings of the PDFs&#x27; contents</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PdfReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pdf_source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _pdf_text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page_number </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> page </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        page_number </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _pdf_text </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">extract_text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;\nPage Number: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">page_number</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _pdf_text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ... </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chunked_text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raw_text</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_token_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tokenizer_encoding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cl100k_base&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Chunks the pdf text into smaller chunks of size max_token_length.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param pdf_text: the Series of individual pdf texts to chunk.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param max_token_length: the maximum length of tokens in each chunk.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param tokenizer_encoding: the encoding to use for the tokenizer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return: Series of chunked pdf text. Each element is a list of chunks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tokenizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tiktoken</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_encoding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenizer_encoding</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _encoded_chunks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _create_chunks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">raw_text</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_token_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _decoded_chunks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tokenizer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> _encoded_chunks</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _decoded_chunks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ... </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">summarized_text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prompt_and_text_content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    openai_gpt_model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Summarizes the text from the summarized chunks of the pdf.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param prompt_and_text_content: the prompt and content to send over.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param openai_gpt_model: which openai gpt model to use.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return: the string response from the openai API.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> openai</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ChatCompletion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">openai_gpt_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        messages</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prompt_and_text_content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        temperature</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;choices&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># run as a script to test Hamilton&#x27;s execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> summarization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> hamilton </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> driver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Driver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summarization</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        adapter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SimplePythonGraphAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DictResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">display_all_functions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;summary&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;png&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice the chunking of code into functions. Each one has a clear role and shouldn’t have too many lines of code. It’s easy to understand a function’s purpose through its name, type annotations, docstring, and dependencies specified as arguments. As a bonus, Hamilton can produce a visualization of the module’s execution DAG for free! The top-level nodes, such as <code>user_query</code> and <code>openai_gpt_model</code>, are exposed to the user through the frontend and are processed down the DAG via FastAPI.</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-3-66d249a1970e698b173673a186f2b794.png" width="1308" height="347" class="img_ev3q"></p>
<p>Also, you might have noticed at the end the <code>if _name__ == “__main__”:</code> and the module importing itself via <code>import summarization</code>. This effectively allows you to load the module and execute it with Hamilton <em>outside</em> of the FastAPI server. This makes it easy to run and iterate over your Hamilton transformations during development, or <a href="https://en.wikipedia.org/wiki/Unit_testing" target="_blank" rel="noopener noreferrer">unit test</a> them outside of your FastAPI web service.</p>
<hr>
<p>Now let’s look at server.py:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">FastAPI server</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># server.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ... imports</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> summarization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># instantiate FastAPI app</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FastAPI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># define constants for Hamilton driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">driver_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;pdf&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># instantiate the Hamilton driver; it will power all API endpoints</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># async driver for use with async functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async_dr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> h_async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AsyncDriver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    summarization</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># python module containing function logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result_builder</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DictResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># sync driver for use with regular functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sync_dr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> driver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Driver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    summarization</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># python module containing function logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    adapter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SimplePythonGraphAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DictResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SummarizeResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pydantic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Response to the /summarize endpoint&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    summary</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/summarize&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">summarize_pdf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pdf_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UploadFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    openai_gpt_model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Form</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># = &quot;gpt-3.5-turbo-0613&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Form</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># = &quot;Scientific article&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_query</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Form</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># = &quot;Can you ELI5 the paper?&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SummarizeResponse</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Request `summarized_text` from Hamilton driver with `pdf_file` and `user_query`&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> async_dr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;summarized_text&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inputs</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pdf_source</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pdf_file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            openai_gpt_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">openai_gpt_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            content_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">content_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            user_query</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SummarizeResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">summary</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;summarized_text&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/summarize_sync&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">summarize_pdf_sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pdf_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UploadFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    openai_gpt_model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Form</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># = &quot;gpt-3.5-turbo-0613&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Form</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># = &quot;Scientific article&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_query</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Form</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># = &quot;Can you ELI5 the paper?&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SummarizeResponse</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Request `summarized_text` from Hamilton driver with `pdf_file` and `user_query`&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sync_dr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;summarized_text&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inputs</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pdf_source</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pdf_file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            openai_gpt_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">openai_gpt_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            content_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">content_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            user_query</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user_query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SummarizeResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">summary</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;summarized_text&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># add to SwaggerUI the execution DAG png</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># see http://localhost:8080/docs#/default/summarize_pdf_summarize_post</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">base64_viz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;summarization_module.png&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;utf-8&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">routes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;&quot;&quot;&lt;h1&gt;Execution DAG&lt;/h1&gt;&lt;img alt=&quot;&quot; src=&quot;data:image/png;base64,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">base64_viz</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;/&gt;&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># run as a script to test server locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> uvicorn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uvicorn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0.0.0.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The file server.py is responsible of instantiating FastAPI and defining the server’s endpoints. We also instantiate <em>synchronous</em> and <em>asynchronous</em> Hamilton Driver objects to power both types of endpoint styles that FastAPI supports (<strong>Note</strong>. <a href="https://fastapi.tiangolo.com/async/#in-a-hurry" target="_blank" rel="noopener noreferrer">FastAPI manages non-async functions like async ones</a>). Then, in the endpoints definitions, it is a matter of handling the request data, passing it to Hamilton and requesting the variable summarized_text, and sending a formatted response to the client.</p>
<p>Towards the end of the snippet, there is a cryptic line of code that encodes the visualization of the Hamilton Driver as <code>base64</code> and embeds it in the FastAPI generated Swagger UI for great documentation!</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-4-cb2d104268523d5785cac6c9d78e7dc6.png" width="975" height="1104" class="img_ev3q"></p>
<p>Again, you’ll find a <code>if _name__ == “__main__”:</code> statement allowing you to start a local server by calling python server.py. This way, you can test your server code independently from your Hamilton transformations and then add <a href="https://en.wikipedia.org/wiki/Integration_testing" target="_blank" rel="noopener noreferrer">integration tests</a>.</p>
<p>To learn more about the frontend, we invite you to view <a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/LLM_Workflows/pdf_summarizer" target="_blank" rel="noopener noreferrer">the full example on GitHub</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="to-recap">To recap<a href="#to-recap" class="hash-link" aria-label="Direct link to To recap" title="Direct link to To recap">​</a></h2>
<p>In this post we showed how to:</p>
<ul>
<li>Break down a PDF summarizer flow into individual functions with Hamilton</li>
<li>Use Hamilton for inference with FastAPI, and exercise the required DAG inputs through POST requests</li>
<li>Decouple the code for the UI, server, and application logic to enable faster development</li>
<li>Structure a project’s directory and code to help readability and maintainability</li>
</ul>
<p>The function-centric approach of Hamilton makes it easy to update or extend your application dataflow. For example, you could swap out OpenAI API for Anthropic (<a href="https://blog.dagworks.io/p/building-a-maintainable-and-modular" target="_blank" rel="noopener noreferrer">Learn how to swap stack components</a>), or add document processing steps by writing a few functions. With Hamilton being open source and being an extensible platform, motivated developers can tailor it to their needs for example by implementing custom caching strategies (e.g. <a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/caching_nodes" target="_blank" rel="noopener noreferrer">use this, or extend it</a>), data validation steps (e.g. <a href="https://hamilton.dagworks.io/en/latest/reference/decorators/check_output/#check-output" target="_blank" rel="noopener noreferrer">use/extend this</a>), or telemetry capture.</p>
<p>Like what you heard? We’d love a <a href="https://github.com/DAGWorks-Inc/hamilton" target="_blank" rel="noopener noreferrer">star on GitHub</a> and/or subscribe to this blog to get updates.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What’s next<a href="#whats-next" class="hash-link" aria-label="Direct link to What’s next" title="Direct link to What’s next">​</a></h2>
<p>Thanks for getting this far! As we mentioned in the beginning we’ve got a bunch of exciting content planned🥳 Here’s a few lines about some of our upcoming posts on how to build LLM-based applications for production. Subscribe to get updates as we publish them!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-its-important-and-with-hamilton-its-simpler">Testing: it’s important and with Hamilton it’s simpler<a href="#testing-its-important-and-with-hamilton-its-simpler" class="hash-link" aria-label="Direct link to Testing: it’s important and with Hamilton it’s simpler" title="Direct link to Testing: it’s important and with Hamilton it’s simpler">​</a></h3>
<p>Deploying and maintaining an application in production requires great testing practices. You’ll find that the functions and the dataflows defined with Hamilton are much friendlier to test than object-oriented frameworks. In this next blog, we’ll add to the PDF summarizer unit tests for Hamilton functions, integration tests to use Hamilton with FastAPI, and data validation checks to ensure correct outputs from the LLMs. We’ll also show you how to pull intermediate values from the DAG to plug into your monitoring system!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spark-scale-up-your-hamilton-dataflow-with-the-spark-executor">Spark: scale up your Hamilton dataflow with the Spark executor<a href="#spark-scale-up-your-hamilton-dataflow-with-the-spark-executor" class="hash-link" aria-label="Direct link to Spark: scale up your Hamilton dataflow with the Spark executor" title="Direct link to Spark: scale up your Hamilton dataflow with the Spark executor">​</a></h3>
<p>Did you know that Hamilton allows you to scale up your dataflow to run in a batch workflow without migrating your code? Your dataflow defined for FastAPI can also run on Spark! In the follow-up post, we’ll show how to take the summarizer dataflow and run it on Spark to process lots of tables of data &amp; PDFs in parallel. Operating efficiently at scale is important to be able to re-process all of your documents when upgrading your dataflow (e.g., computing embeddings with a new LLM). Also, this is a key feature to prevent <a href="https://www.hopsworks.ai/dictionary/online-offline-feature-skew" target="_blank" rel="noopener noreferrer">implementation skew</a> between online &amp; offline efforts.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rag-expand-your-hamilton-application-to-cover-ingestion-and-retrieval">RAG: expand your Hamilton application to cover ingestion and retrieval<a href="#rag-expand-your-hamilton-application-to-cover-ingestion-and-retrieval" class="hash-link" aria-label="Direct link to RAG: expand your Hamilton application to cover ingestion and retrieval" title="Direct link to RAG: expand your Hamilton application to cover ingestion and retrieval">​</a></h3>
<p>Instead of being passed in the PDF to summarize, we might have a corpus of documents to choose from to answer users queries. In this upcoming post, we’ll extend the PDF summarizer to a typical <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/jumpstart-foundation-models-customize-rag.html" target="_blank" rel="noopener noreferrer">Retrieval Augmented Generation (RAG)</a> workflow. You’ll see how Hamilton can manage multiple flows (ingestion, retrieval, summarization) and expose them via API endpoints for an end-to-end RAG application. In the meantime, <a href="https://blog.dagworks.io/p/building-a-maintainable-and-modular" target="_blank" rel="noopener noreferrer">this blog post</a> shows the precursor step of ingesting data into a vector database for RAG use with Hamilton.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="want-lineage-catalog-and-observability-out-of-the-box-use-hamilton--dagworks">Want lineage, catalog, and observability out of the box? Use Hamilton + DAGWorks.<a href="#want-lineage-catalog-and-observability-out-of-the-box-use-hamilton--dagworks" class="hash-link" aria-label="Direct link to Want lineage, catalog, and observability out of the box? Use Hamilton + DAGWorks." title="Direct link to Want lineage, catalog, and observability out of the box? Use Hamilton + DAGWorks.">​</a></h2>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-5-3bf77f3353d59b0942067067948a777d.png" width="1456" height="314" class="img_ev3q"></p>
<p>Lastly before we go, if you’re interested in automatically capturing versions of flows, seeing inputs, executions, and observing what happened - you can try out what we’re building at <a href="https://www.dagworks.io/" target="_blank" rel="noopener noreferrer">DAGWorks</a> with a <a href="https://github.com/DAGWorks-Inc/hamilton/blob/main/examples/LLM_Workflows/pdf_summarizer/backend/server.py#L36-L45" target="_blank" rel="noopener noreferrer">one-line replacement</a>.</p>
<p>The DAGWorks platform helps you:</p>
<ul>
<li><strong>Version dataflows</strong>. As you iterate and change the shape, contents and structure of your code, DAGWorks tracks changes and allows you to view diffs.</li>
<li><strong>Monitor runs</strong>. Understand which DAG nodes were executed, how long it took, what were the outputs, etc. from your dashboard.</li>
<li><strong>Debug failures</strong>. DAG execution errors are contextualized with other node results and you can compare across multiple runs to view DAG changes.</li>
</ul>
<p>To get started, in the example we have a few commented out pieces of code you’ll need to flip on (quick instructions <a href="https://github.com/DAGWorks-Inc/hamilton/blob/main/examples/LLM_Workflows/pdf_summarizer/README.md#connecting-to-dagworks" target="_blank" rel="noopener noreferrer">here</a> and DAGWorks docs <a href="https://docs.dagworks.io/introduction" target="_blank" rel="noopener noreferrer">here</a>):</p>
<ol>
<li>Install <code>dagworks-sdk</code> – uncomment <a href="https://github.com/DAGWorks-Inc/hamilton/blob/main/examples/LLM_Workflows/pdf_summarizer/backend/requirements.txt#L11" target="_blank" rel="noopener noreferrer">this line</a> in <code>requirements.txt</code>.</li>
<li>Add the <code>DAGWORKS_API_KEY</code> to <code>.env</code> – <a href="https://www.dagworks.io/pricing" target="_blank" rel="noopener noreferrer">sign up</a> for an account there’s a free tier! Create an <code>API_KEY</code> and save it.</li>
<li>Create a DAGWorks project – note the project ID (see docs <a href="https://docs.dagworks.io/introduction" target="_blank" rel="noopener noreferrer">here</a> for how to do that).</li>
<li>Instantiate the DAGWorks Driver – <a href="https://github.com/DAGWorks-Inc/hamilton/blob/main/examples/LLM_Workflows/pdf_summarizer/backend/server.py#L34-L45" target="_blank" rel="noopener noreferrer">uncomment this code</a> in the server to instantiate the DAGWorks driver and fill in your project details.</li>
<li>Rebuild the containers and you’re good to go!</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="we-want-to-hear-from-you">We want to hear from you!<a href="#we-want-to-hear-from-you" class="hash-link" aria-label="Direct link to We want to hear from you!" title="Direct link to We want to hear from you!">​</a></h2>
<p>If you’re excited by any of this, or have strong opinions, drop by our Slack channel / or leave some comments here! Some resources to get you help:</p>
<p>📣 join our community on <a href="https://join.slack.com/t/hamilton-opensource/shared_invite/zt-1bjs72asx-wcUTgH7q7QX1igiQ5bbdcg" target="_blank" rel="noopener noreferrer">Slack</a>  —  we’re more than happy to help answer questions you might have or get you started.</p>
<p>⭐️ us on <a href="https://github.com/DAGWorks-Inc/hamilton" target="_blank" rel="noopener noreferrer">GitHub</a></p>
<p>📝 leave us an <a href="https://github.com/DAGWorks-Inc/hamilton/issues" target="_blank" rel="noopener noreferrer">issue</a> if you find something</p>
<p>Other Hamilton posts you might be interested in:</p>
<ul>
<li><a href="https://www.tryhamilton.dev/" target="_blank" rel="noopener noreferrer">tryhamilton.dev</a> – an interactive tutorial in your browser!</li>
<li><a href="https://blog.dagworks.io/p/building-a-maintainable-and-modular" target="_blank" rel="noopener noreferrer">Build a modular LLM stack with Hamilton</a></li>
<li><a href="https://blog.dagworks.io/publish/post/130538397" target="_blank" rel="noopener noreferrer">Hamilton + Airflow</a> (<a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/airflow" target="_blank" rel="noopener noreferrer">GitHub repo</a>)</li>
<li><a href="https://blog.dagworks.io/p/featurization-integrating-hamilton" target="_blank" rel="noopener noreferrer">Hamilton + Feast</a> (<a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/feast" target="_blank" rel="noopener noreferrer">GitHub repo</a>)</li>
<li><a href="https://blog.dagworks.io/p/how-to-use-hamilton-with-pandas-in-5-minutes-89f63e5af8f5" target="_blank" rel="noopener noreferrer">Pandas data transformations in Hamilton in 5 minutes</a></li>
<li><a href="https://blog.dagworks.io/p/lineage-hamilton-in-10-minutes-c2b8a944e2e6" target="_blank" rel="noopener noreferrer">Lineage + Hamilton in 10 minutes</a></li>
</ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/hamilton">Hamilton</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/open-ai">OpenAI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/llm">LLM</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/fast-api">FastAPI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/docker">Docker</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/personal_website/blog/rag"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Retrieval augmented generation (RAG) with Streamlit, FastAPI, Weaviate, and Hamilton!</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/personal_website/blog/feast-hamilton"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Featurization: Integrating Hamilton with Feast</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-first-generation-of-large-language-models-applications" class="table-of-contents__link toc-highlight">The first generation of large language models applications</a></li><li><a href="#hamilton-for-llm-and-nlp-flows" class="table-of-contents__link toc-highlight">Hamilton for LLM and NLP flows</a></li><li><a href="#building-a-modular-pdf-summarizer-application" class="table-of-contents__link toc-highlight">Building a modular PDF summarizer application</a></li><li><a href="#to-recap" class="table-of-contents__link toc-highlight">To recap</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What’s next</a><ul><li><a href="#testing-its-important-and-with-hamilton-its-simpler" class="table-of-contents__link toc-highlight">Testing: it’s important and with Hamilton it’s simpler</a></li><li><a href="#spark-scale-up-your-hamilton-dataflow-with-the-spark-executor" class="table-of-contents__link toc-highlight">Spark: scale up your Hamilton dataflow with the Spark executor</a></li><li><a href="#rag-expand-your-hamilton-application-to-cover-ingestion-and-retrieval" class="table-of-contents__link toc-highlight">RAG: expand your Hamilton application to cover ingestion and retrieval</a></li></ul></li><li><a href="#want-lineage-catalog-and-observability-out-of-the-box-use-hamilton--dagworks" class="table-of-contents__link toc-highlight">Want lineage, catalog, and observability out of the box? Use Hamilton + DAGWorks.</a></li><li><a href="#we-want-to-hear-from-you" class="table-of-contents__link toc-highlight">We want to hear from you!</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© Copyright 2024, Thierry Jean. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>