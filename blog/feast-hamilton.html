<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Featurization: Integrating Hamilton with Feast | More is more</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zilto.github.io/personal_website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://zilto.github.io/personal_website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://zilto.github.io/personal_website/blog/feast-hamilton"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Featurization: Integrating Hamilton with Feast | More is more"><meta data-rh="true" name="description" content="Are you using Feast? or perhaps you are having trouble with it? Or perhaps you are considering adopting it? In this post, you will learn the operational benefits of using Feast with Hamilton. Feast will act as your “feature store”, while Hamilton will be your in-process “feature processing engine”. We start by providing an overview of Feast, then show how Hamilton fits into the picture. At the end, we give a recipe for where to go from here, depending on where you are in your “feature journey”."><meta data-rh="true" property="og:description" content="Are you using Feast? or perhaps you are having trouble with it? Or perhaps you are considering adopting it? In this post, you will learn the operational benefits of using Feast with Hamilton. Feast will act as your “feature store”, while Hamilton will be your in-process “feature processing engine”. We start by providing an overview of Feast, then show how Hamilton fits into the picture. At the end, we give a recipe for where to go from here, depending on where you are in your “feature journey”."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-02T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/zilto"><meta data-rh="true" property="article:tag" content="Hamilton,Feast,feature store"><link data-rh="true" rel="icon" href="/personal_website/img/icon.png"><link data-rh="true" rel="canonical" href="https://zilto.github.io/personal_website/blog/feast-hamilton"><link data-rh="true" rel="alternate" href="https://zilto.github.io/personal_website/blog/feast-hamilton" hreflang="en"><link data-rh="true" rel="alternate" href="https://zilto.github.io/personal_website/blog/feast-hamilton" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/personal_website/blog/rss.xml" title="MoreIsMore RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/personal_website/blog/atom.xml" title="MoreIsMore Atom Feed">
<link rel="alternate" type="application/json" href="/personal_website/blog/feed.json" title="MoreIsMore JSON Feed"><link rel="stylesheet" href="/personal_website/assets/css/styles.e01dfa2e.css">
<script src="/personal_website/assets/js/runtime~main.bb6063f8.js" defer="defer"></script>
<script src="/personal_website/assets/js/main.27b89429.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/personal_website/"><div class="navbar__logo"><img src="/personal_website/img/icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/personal_website/img/icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">More is more</b></a><a class="navbar__item navbar__link" href="/personal_website/docs/category/personal-projects">Portfolio</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/personal_website/blog">Blog</a><a class="navbar__item navbar__link" href="/personal_website/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/thierry-jean/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Let&#x27;s connect<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/rag">Retrieval augmented generation (RAG) with Streamlit, FastAPI, Weaviate, and Hamilton!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/pdf-summarizer">Containerized PDF Summarizer with FastAPI and Hamilton</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/personal_website/blog/feast-hamilton">Featurization: Integrating Hamilton with Feast</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/prefect-hamilton">Simplify Prefect Workflow Creation and Maintenance with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/modular-llm">Building a maintainable and modular LLM application stack with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/airflow-hamilton">Simplify Airflow DAG Creation and Maintenance with Hamilton</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal_website/blog/perks-of-hamilton">The perks of creating dataflows with Hamilton</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Are you using Feast? or perhaps you are having trouble with it? Or perhaps you are considering adopting it? In this post, you will learn the operational benefits of using Feast with Hamilton. Feast will act as your “feature store”, while Hamilton will be your in-process “feature processing engine”. We start by providing an overview of Feast, then show how Hamilton fits into the picture. At the end, we give a recipe for where to go from here, depending on where you are in your “feature journey”."><header><h1 class="title_f1Hy" itemprop="headline">Featurization: Integrating Hamilton with Feast</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-02T00:00:00.000Z" itemprop="datePublished">August 2, 2023</time> · <!-- -->17 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zilto.png" alt="Thierry Jean" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zilto" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Thierry Jean</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Are you using Feast? or perhaps you are having trouble with it? Or perhaps you are considering adopting it? In this post, you will learn the operational benefits of using Feast with Hamilton. Feast will act as your “feature store”, while Hamilton will be your in-process “feature processing engine”. We start by providing an overview of Feast, then show how Hamilton fits into the picture. At the end, we give a recipe for where to go from here, depending on where you are in your “feature journey”.</p>
<blockquote>
<p>crosspost from <a href="https://blog.dagworks.io/p/featurization-integrating-hamilton" target="_blank" rel="noopener noreferrer">https://blog.dagworks.io/p/featurization-integrating-hamilton</a></p>
</blockquote>
<blockquote>
<p>Note: by “feature” we are referring to <a href="https://en.wikipedia.org/wiki/Feature_(machine_learning)" target="_blank" rel="noopener noreferrer">this meaning of the word</a>.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-problem-does-feast-solve">What problem does Feast solve?<a href="#what-problem-does-feast-solve" class="hash-link" aria-label="Direct link to What problem does Feast solve?" title="Direct link to What problem does Feast solve?">​</a></h2>
<p>Feast is an open-source <a href="https://www.featurestore.org/what-is-a-feature-store" target="_blank" rel="noopener noreferrer">feature store</a>, a specialized piece of machine learning (ML) infrastructure that centralizes computed feature data and metadata. The feature store sits above the storage layer and unifies the output of various data sources (streaming, operational databases, data warehouse, app session, etc.) to provide a simple interface to query features for your ML application. Feature stores are critical to the operations of organizations serving high volumes of predictions (e.g., Uber, AirBnb, LinkedIn).</p>
<blockquote>
<p>Note: Feature stores introduce a lot of complexity that should be justified by a decent number of projects in production. Please read <a href="https://medium.com/data-for-ai/feature-pipelines-and-feature-stores-deep-dive-into-system-engineering-and-analytical-tradeoffs-3c208af5e05f" target="_blank" rel="noopener noreferrer">this blog</a> by FeatureStoresForML for a detailed look at the pros and cons of feature stores. You may only need Hamilton, in which case, we direct readers to our <a href="https://hamilton.dagworks.io/en/latest/how-tos/use-for-feature-engineering/" target="_blank" rel="noopener noreferrer">documentation</a> and <a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/feature_engineering_multiple_contexts" target="_blank" rel="noopener noreferrer">example</a> to get you started!</p>
</blockquote>
<p>The feature store abstraction delineates feature producers from downstream users (feature consumers), effectively creating a contract between the two parties. Feature creation and use can get messy, especially when one wants to share them across an organization. One way to do that is to centralize features via data, i.e. put them all into the same store, and users can pull from this store to power their machine learning models. A feature store can then offer guardrails to ensure that offline model training matches online settings (i.e., preventing <a href="https://developers.google.com/machine-learning/guides/rules-of-ml#training-serving_skew" target="_blank" rel="noopener noreferrer">training/serving skew</a>). Feature stores can help reduce system latency by caching features in an “online store” (more on that below) for efficient retrieval.  This <a href="https://medium.com/@endeavordata/streamlining-machine-learning-development-with-a-feature-store-680ee6d45c64" target="_blank" rel="noopener noreferrer">blog</a> explains further the benefits of centralizing data into a feature store.</p>
<p>The <a href="https://docs.feast.dev/#example-use-cases" target="_blank" rel="noopener noreferrer">Feast documentation</a> mentions the following typical use cases:</p>
<ul>
<li>Personalizing online recommendations by leveraging pre-computed historical user or item features.</li>
<li>Online fraud detection, using features that compare against (pre-computed) historical transaction patterns</li>
<li>Credit scoring, using pre-computed historical features to compute probability of default</li>
<li>Churn prediction (an offline model), generating feature values for all users at a fixed cadence in batch</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-feast">What is Feast?<a href="#what-is-feast" class="hash-link" aria-label="Direct link to What is Feast?" title="Direct link to What is Feast?">​</a></h2>
<p>If one is unfamiliar with Feast, we recommend reading the Feast <a href="https://docs.feast.dev/" target="_blank" rel="noopener noreferrer">introduction page</a>, but here are some high-level key considerations:</p>
<p><strong>What Feast does</strong>:</p>
<ul>
<li>Stores metadata on features that have been registered with it</li>
<li>Provides an abstraction to push to &amp; query for materialized feature data.</li>
<li>Facilitates proper <a href="https://docs.feast.dev/getting-started/concepts/point-in-time-joins" target="_blank" rel="noopener noreferrer">point-in-time</a> (i.e., “time-travel”) table joins. Useful for creating training sets from features.</li>
<li>Helps you integrate heterogeneous sources of feature data into a central place.</li>
</ul>
<p><strong>What Feast doesn’t do</strong>:</p>
<ul>
<li>Perform the transformations to compute your features.</li>
<li>Store data itself; it relies on being set up on top of your existing infrastructure.</li>
<li>Orchestrate your data transformation pipelines that would perform feature computation.</li>
<li>Help you write clean transformation code &amp; organize it.</li>
<li>Provide lineage &amp; provenance for your features.</li>
</ul>
<p>Here are a few <a href="https://docs.feast.dev/getting-started/concepts" target="_blank" rel="noopener noreferrer">Feast key terms</a> relevant to this post:</p>
<ul>
<li><strong>Entity</strong>: a real-world entity we care about (e.g., user, city, month, product SKU).</li>
<li><strong>DataSource</strong>: a physical storage of data (e.g., file, database, data warehouse).</li>
<li><strong>FeatureView</strong>: the table schema of a data source with additional metadata.</li>
<li><strong>FeatureService</strong>: a new table schema resulting from joining one or more FeatureViews.</li>
<li><strong>Offline store</strong>: an interface to read DataSources and do the point-in-time joins at query time.</li>
<li><strong>Online store</strong>: an interface to read FeatureService already stored with the joins completed.</li>
<li><strong>Feast registry</strong>: the single central catalog containing the defined Feast objects and relationships.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-on-feature-computation-and-lineage">More on feature computation and lineage<a href="#more-on-feature-computation-and-lineage" class="hash-link" aria-label="Direct link to More on feature computation and lineage" title="Direct link to More on feature computation and lineage">​</a></h2>
<p>Since Feast is only responsible for the downstream use of features, it <a href="https://docs.feast.dev/#feast-is-not" target="_blank" rel="noopener noreferrer">cannot compute them nor produce full lineage</a> from raw data for you. Feast validates the table schema you pass to it (columns name and type), but it can’t catch upstream data transformation changes that don&#x27;t respect the desired schema.</p>
<p>Without lineage, it is not possible to enforce CI/CD checks of the schema and trigger a recompute of the online store when feature transformations are updated for example. Additionally, not having lineage makes it hard to trace source data usage, remove dead feature code, as well as deprecate unused features, all which are important to help ensure smooth and cost efficient operations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-hamilton-help">How can Hamilton help?<a href="#how-can-hamilton-help" class="hash-link" aria-label="Direct link to How can Hamilton help?" title="Direct link to How can Hamilton help?">​</a></h2>
<p>Hamilton is a Python micro-orchestration framework to express data transformations. It helps one write Python code that is modular and reusable, and that can be executed as a direct acyclic graph (DAG). Hamilton was initially developed and used in production to create large dataframes (100+ columns) for machine learning while preserving strong lineage capabilities (see <a href="https://blog.dagworks.io/p/functions-dags-introducing-hamilton-a-microframework-for-dataframe-generation-more-8e34b84efc1d" target="_blank" rel="noopener noreferrer">the origin story</a>). Its strength is expressing the flow of data &amp; computation in a way that is straightforward to create and maintain (much like DBT does for SQL). If you are considering Feast, it likely means you also have some data scale, so just to mention it, that Hamilton can be run at scale as well. It has integrations with Spark, Dask, Ray, and can even scale up your pandas code for free (<a href="https://hamilton.dagworks.io/en/latest/how-tos/scale-up/" target="_blank" rel="noopener noreferrer">learn more here</a>)!</p>
<blockquote>
<p>If you are new to Hamilton, we invite you to an interactive overview on <a href="http://www.tryhamilton.dev" target="_blank" rel="noopener noreferrer">tryhamilton.dev</a>, or this post. Hamilton will be discussed at a high level and relevant documentation references will be shared for more details.</p>
</blockquote>
<p>Hamilton is a flexible tool to express DAGs and can improve the Feast development experience in two primary ways:</p>
<ol>
<li>unifying how feature transformations are defined, executed across your stack</li>
<li>define and manage the Feast objects you use to register features with Feast.</li>
</ol>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-edc41774028e5a81a268163ce9108c24.png" width="782" height="292" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-use-hamilton-for-data-transformations-before-pushing-to-feast">1. Use Hamilton for data transformations before pushing to Feast<a href="#1-use-hamilton-for-data-transformations-before-pushing-to-feast" class="hash-link" aria-label="Direct link to 1. Use Hamilton for data transformations before pushing to Feast" title="Direct link to 1. Use Hamilton for data transformations before pushing to Feast">​</a></h3>
<p>With Hamilton, you write declarative and granular data transformation functions. The functions declare what they output with the <strong>function name</strong> and declare what they require as input with the <strong>function arguments</strong>, and everything is type annotated. The logic of the computation is wholly contained within the function. The Hamilton Driver, which orchestrates execution in a python process, automatically generates the execution DAG from the function definitions and allows you to query for only the set of transforms you are interested in computing.</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-1-6b730d286b040562659cc780fc12a680.png" width="1037" height="682" class="img_ev3q"></p>
<p>Using this approach, you can easily scale to writing dataframes with 1000s of columns and maintain a clear lineage of upstream and downstream dependencies. To generate your features, simply call <code>Driver.execute()</code> and write the resulting dataframe to your Feast offline or online store. You can reuse the modular functions you define both in your offline and online environment to prevent training/serving skew.  Also, the defined Hamilton functions can be easily reused in Feast’s <a href="https://docs.feast.dev/reference/alpha-on-demand-feature-view" target="_blank" rel="noopener noreferrer">OnDemandFeatureView</a> when dealing with request data. In addition, Hamilton enables runtime data validation on any function by adding the <code>@check_output</code> decorator (<a href="https://hamilton.dagworks.io/en/latest/how-tos/run-data-quality-checks/" target="_blank" rel="noopener noreferrer">learn more</a>), which can again mitigate training/serving skew and ensure feature output is checked before it is pushed to Feast.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Push data to Feast</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> hamilton</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">function_modifiers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> extract_columns</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> save_to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> check_output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TRIPS_SOURCE_COLUMNS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;event_timestamp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;driver_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;rider_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;trip_dist&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;created&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># extract columns allows you to split a dataframe into multiple pandas Series</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@extract_columns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">TRIPS_SOURCE_COLUMNS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">trips_raw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trips_raw_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Load the driver dataset&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_parquet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trips_raw_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;event_timestamp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> df</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">day_of_week</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event_timestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Encode day of the week as int&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event_timestamp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">day_of_week</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;day_of_week&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">event_timestamp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># see how this function depends on the return value of `day_of_week()`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@check_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">int64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data_in_range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> importance</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;warn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">is_weekend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">day_of_week</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weekend </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">day_of_week </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">weekend</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;is_weekend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">day_of_week</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">percentile_dist_rolling_3h</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trip_dist</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_timestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Compute the rolling 3H percentile trip dist&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">trip_dist</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_timestamp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rolling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;3H&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;event_timestamp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;trip_dist&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pct</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">agg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;percentile_trip_dist_rolling_3h&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">event_timestamp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># this function has many lines, but it simply explicitly assemble columns from the raw</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># source and the computed features.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the @save_to decorator allows to easily save this result to a parquet file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@save_to</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">parquet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;trips_stats_3h_path&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> output_name_</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;save_trips_stats_3h&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">trips_stats_3h</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event_timestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    day_of_week</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_weekend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    percentile_dist_rolling_3h</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Global trip statistics over rolling 3h&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            event_timestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            driver_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            day_of_week</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            is_weekend</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            percentile_dist_rolling_3h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This code snippet shows broadly the Hamilton approach to defining feature transforms. There is a function that loads a dataframe and exposes its columns (i.e. individual pandas series) for downstream use; typically this could be a call to a database to return a dataframe. Then, features are created by applying functions on these pandas series. Notably, <code>percentile_dist_rolling_3h()</code> takes two pandas series as input, creates a temporary dataframe in the function’s body to apply a rolling window, and returns a new pandas series. Hamilton provides a lot of utilities to avoid code duplication across similar features. You can learn more about them from the examples in the <a href="https://hamilton.dagworks.io/en/latest/concepts/decorators-overview/" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-2-be636da9545259bb9a9f22829a67feb6.png" width="1456" height="393" class="img_ev3q"></p>
<p>Hamilton pairs so well with Feast because they were both designed around the table/dataframe abstraction. Hamilton enables you to create complex dataframes using functions that are easy to read, test, and document, and you also get <a href="https://blog.dagworks.io/p/lineage-hamilton-in-10-minutes-c2b8a944e2e6" target="_blank" rel="noopener noreferrer">lineage as code</a>! This increased visibility makes it easier for downstream Feast users to trust data definitions and therefore feature quality.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-use-hamilton-to-wrangle-feast-definitions">2. Use Hamilton to wrangle Feast definitions<a href="#2-use-hamilton-to-wrangle-feast-definitions" class="hash-link" aria-label="Direct link to 2. Use Hamilton to wrangle Feast definitions" title="Direct link to 2. Use Hamilton to wrangle Feast definitions">​</a></h3>
<p>Feast defines its registry objects in Python. For Feast to know about features you need to explicitly register them. At registration, when calling <code>feast apply</code> objects are converted to <a href="https://protobuf.dev/" target="_blank" rel="noopener noreferrer">protobuf</a> and feature object relationships are built. However, the dependencies between feature objects are not made explicit from the Python code definitions that Feast makes your write. To add to this, the Feast CLI is able to read feature object definitions across directories, which inadvertently allows the proliferation of feature object definitions across a codebase. This makes it hard for someone reading the codebase to develop a mental model of these relationships. Considering Feast is essentially a DAG, wrapping object definitions in Hamilton functions can greatly improve readability and reduce the chances of breaking changes.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> feast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># an entity has no upstream dependencies; it is our join index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">driver_entity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Entity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Feast definition: driver entity&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Entity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;driver&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> join_keys</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;driver_id&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ValueType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">INT64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the filesource only needs a file path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># it could have been hardcoded, but here we pass it as argument because we want to ensure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># that is it the same value passed as the storage for our feature_transformations.py code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">driver_hourly_stats_source</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">driver_source_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FileSource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Feast definition: source with hourly stats of driver&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FileSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;driver_hourly_stats&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">driver_source_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timestamp_field</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;event_timestamp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      created_timestamp_column</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;created&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the FeatureView is a 1-to-1 with the DataSource, but adds metadata and time-to-live (TTL)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">driver_hourly_stats_fv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  driver_entity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Entity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  driver_hourly_stats_source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FileSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FeatureView</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Feast definition: feature view with hourly stats of driver&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FeatureView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;driver_hourly_stats&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      entities</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">driver_entity</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ttl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">days</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      schema</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;conv_rate&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Float32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;acc_rate&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Float32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;avg_daily_trips&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Int64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Average daily trips&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      online</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">driver_hourly_stats_source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tags</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;team&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;driver_performance&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the FeatureService defines how the data is stored in the online store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># and how it&#x27;s retrieved</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">driver_activity_v1_fs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   driver_hourly_stats_fv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FeatureView</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FeatureService</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Feast definition: grouping of features relative to driver activity&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> feast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FeatureService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;driver_activity_v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        features</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            driver_hourly_stats_fv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The code shows a snippet from the <code>store_definitions.py</code> file from the Feast example in the Hamilton repository. The Hamilton approach to defining functions makes it easy to read dependencies from the code and prevents synchronization issues between Feast feature object definitions when changes are made. As a bonus, Hamilton can automatically generate visualizations that you can associate with your commit or add to your documentation. Below is the DAG generated that registers the appropriate objects with Feast; Hamilton uses the functions defined in <code>store_definitions.py</code> to create this.</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-3-4d62f67da4a69ea204afec628c2cde4c.png" width="1456" height="463" class="img_ev3q"></p>
<p>As the Feast object graph grows in complexity, it becomes overwhelming to display in its entirety. With the Hamilton <code>driver.what_is_upstream_of()</code> and <code>what_is_downstream_of()</code>, one can quickly answer specific questions about dependencies, by zooming into only what’s relevant to display. For example:</p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-4-0b600c977c2df49b909c88a47746ef0f.png" width="724" height="443" class="img_ev3q"></p>
<p><img loading="lazy" alt="Alt text" src="/personal_website/assets/images/image-5-82c0472e62e0070c085707fab46cd731.png" width="934" height="347" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-full-hamilton--feast-experience">The full Hamilton + Feast experience<a href="#the-full-hamilton--feast-experience" class="hash-link" aria-label="Direct link to The full Hamilton + Feast experience" title="Direct link to The full Hamilton + Feast experience">​</a></h2>
<p>So far, we’ve presented how to use Hamilton to compute the features used in Feast and how to define your Feast objects with Hamilton. By adopting both practices, you can gain visibility over the dataflow from raw data, to feature transformations, to Feast service, effectively extending the contract between data producers and downstream users. If downstream users also use Hamilton to express their data science workflow or power an inference API endpoint, all of the benefits will be further extended! </p>
<p>This integration allows you to foresee which downstream users will be affected by changes to data transformations code and how. For example:</p>
<ol>
<li>
<p>You could add to your CI/CD pipeline checks for changes in the structure of the Hamilton transformations and Feast object definitions DAGs. If detected one could send an alert or request a review from affected users.</p>
</li>
<li>
<p>Changes to the Hamilton DAG could trigger a purge and feature recompute for the Feast online store to prevent any mismatch between a newly trained model and the already stored features.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-the-feature-platform-you-need">Build the feature platform you need<a href="#build-the-feature-platform-you-need" class="hash-link" aria-label="Direct link to Build the feature platform you need" title="Direct link to Build the feature platform you need">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-adopt-hamilton">Step 1: Adopt Hamilton<a href="#step-1-adopt-hamilton" class="hash-link" aria-label="Direct link to Step 1: Adopt Hamilton" title="Direct link to Step 1: Adopt Hamilton">​</a></h3>
<p>We candidly believe that Hamilton is a great addition, no matter the stage of maturity your feature needs are in. If you have existing code, it usually only takes you 10-25% of the initial development time to refactor code into the Hamiltonian style.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-feature-store">Step 2: Feature Store?<a href="#step-2-feature-store" class="hash-link" aria-label="Direct link to Step 2: Feature Store?" title="Direct link to Step 2: Feature Store?">​</a></h3>
<p>But when to do you use/adopt Feast? That’s a different question. Feast has some compelling features, but it is important to evaluate a team’s needs and capabilities, present and future, before making important infrastructure decisions. Make sure to read this excellent <a href="https://medium.com/data-for-ai/feature-pipelines-and-feature-stores-deep-dive-into-system-engineering-and-analytical-tradeoffs-3c208af5e05f" target="_blank" rel="noopener noreferrer">blog</a> to review the pros and cons of feature stores; as noted in the beginning, a feature store is a complex component to integrate and manage, so you should be confident in your decision before moving forward. There are two important lines of questioning:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="would-your-problems-benefit-from-a-feature-store">Would your problems benefit from a feature store?<a href="#would-your-problems-benefit-from-a-feature-store" class="hash-link" aria-label="Direct link to Would your problems benefit from a feature store?" title="Direct link to Would your problems benefit from a feature store?">​</a></h4>
<p>This requires thinking about the nature of the problems you are working on and scoping the pain points you are facing.</p>
<ul>
<li>Are you integrating multiple batch/streaming/request data sources? If you are only pulling everything from a data warehouse, you might not need a feature store.</li>
<li>Are you handling time-series data with complex joins and need point-in-time retrieval? If you are only doing batch predictions with a few joins, you might not need a feature store.</li>
<li>Are you having duplicate definitions and compute of features across projects?</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="what-would-be-the-cost-of-a-maintaining-feature-store">What would be the cost of a maintaining feature store?<a href="#what-would-be-the-cost-of-a-maintaining-feature-store" class="hash-link" aria-label="Direct link to What would be the cost of a maintaining feature store?" title="Direct link to What would be the cost of a maintaining feature store?">​</a></h4>
<p>This requires evaluating the efforts and resources that will be needed to be dedicated to setting up and maintaining the feature store.</p>
<ul>
<li>How many features and projects in production are you actively managing?</li>
<li>Do you have a dedicated team to manage infrastructure? You will need ML or data engineering time to migrate and maintain the feature store. Also, data scientists/teams that built the existing features and pipelines will need to ensure migration correctness.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="some-illustrative-scenarios">Some Illustrative scenarios<a href="#some-illustrative-scenarios" class="hash-link" aria-label="Direct link to Some Illustrative scenarios" title="Direct link to Some Illustrative scenarios">​</a></h2>
<p>Now here are a few prototypical scenarios. You might recognize yourself in one, or find yourself between two, but in all cases remember the earlier the you adopt good coding practices and write modular code, the easiest migrating to a feature store is.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="you-are-just-getting-started-with-data-science-and-machine-learning-and-writing-a-proof-of-concepts">You are just getting started with data science and machine learning and writing a proof of concept(s).<a href="#you-are-just-getting-started-with-data-science-and-machine-learning-and-writing-a-proof-of-concepts" class="hash-link" aria-label="Direct link to You are just getting started with data science and machine learning and writing a proof of concept(s)." title="Direct link to You are just getting started with data science and machine learning and writing a proof of concept(s).">​</a></h3>
<p>You probably do not need a feature store and its overhead before having any project in production as it would slow you down. You are however, more likely to need tooling around versioning your code and experimentation tracking to store and compare model performance and analysis results. Unlike a feature store, Hamilton is lightweight and can help you write better code that will be easier to version. You can use it from day 1 of any project. Use it to write your analysis and keep track of the results of <code>driver.execute()</code> using <a href="https://mlflow.org/docs/latest/index.html" target="_blank" rel="noopener noreferrer">MLFlow</a>, <a href="https://docs.neptune.ai/" target="_blank" rel="noopener noreferrer">Neptune</a>, or <a href="https://docs.wandb.ai/" target="_blank" rel="noopener noreferrer">Weights&amp;Biases</a> for example.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="you-are-managing-a-few-deployed-projects-serving-predictions-to-users">You are managing a few deployed projects serving predictions to users.<a href="#you-are-managing-a-few-deployed-projects-serving-predictions-to-users" class="hash-link" aria-label="Direct link to You are managing a few deployed projects serving predictions to users." title="Direct link to You are managing a few deployed projects serving predictions to users.">​</a></h3>
<p>This is typically when people start looking at tooling to standardize development across projects to reduce duplicated effort and bring some centralization for people to build off of collectively. After answering the above questions, you might conclude that you need a feature store.</p>
<p>If you have the resources to migrate to a feature store, the earlier you migrate the less refactoring you have to do. If you currently don’t have the bandwidth, you can still standardize your practice moving forward and progressively refactor code to prepare for a migration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="you-have-multiple-mature-projects-serving-a-large-number-of-predictions">You have multiple mature projects serving a large number of predictions.<a href="#you-have-multiple-mature-projects-serving-a-large-number-of-predictions" class="hash-link" aria-label="Direct link to You have multiple mature projects serving a large number of predictions." title="Direct link to You have multiple mature projects serving a large number of predictions.">​</a></h3>
<p>As the size and maturity of your data science and ML practice increases, the same logic as the previous section applies, but the cost/benefit ratio can change. The potential benefits are likely evident to you, but refactoring projects powering production services can be risky and very demanding. You should prioritize projects and migrate them one at a time. Adding data validation for data transformations,  Feast ingest, Feast retrieval and model predictions will help prevent breaking changes and diagnose potential problems.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="you-decided-to-migrate-to-feast">You decided to migrate to Feast<a href="#you-decided-to-migrate-to-feast" class="hash-link" aria-label="Direct link to You decided to migrate to Feast" title="Direct link to You decided to migrate to Feast">​</a></h2>
<p>To help, we recommend that data scientists/teams responsible for the projects help with the migration. They will need to specify the entities and the timestamp columns for joins. Then, they should define the meaning of features to include in the Feast registry and refactor code to extract the data transformation functions. If you are not already using Hamilton, the refactoring could be more involved.</p>
<p>With that information, you should be able to write the Feast definitions DAG and register it. If the Feast objects were properly defined, retrieving features from Feast should be equivalent to your previous pipeline on downstream operations.  Then, you should test if you are able to properly materialize/push new data to the online and offline stores.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="you-decided-not-to-migrateadopt-to-feast-yet">You decided not to migrate/adopt to Feast (yet?)<a href="#you-decided-not-to-migrateadopt-to-feast-yet" class="hash-link" aria-label="Direct link to You decided not to migrate/adopt to Feast (yet?)" title="Direct link to You decided not to migrate/adopt to Feast (yet?)">​</a></h2>
<p>You might have realized that your projects wouldn’t benefit from Feast or that more important pain points need to be addressed. Here’s a few examples:</p>
<ul>
<li>You want lineage → Hamilton’s DAG-based paradigm is ideal to clearly establish the dependencies between transformations and the steps data goes through. See <a href="http://www.dagworks.io" target="_blank" rel="noopener noreferrer">DAGWorks</a> that takes this product experience further.</li>
<li>You need to automate tasks or run things on a schedule → look into orchestrators. Hamilton integrates well with any of them, including <a href="https://blog.dagworks.io/p/supercharge-your-airflow-dag-with" target="_blank" rel="noopener noreferrer">Airflow</a>, <a href="https://blog.dagworks.io/p/simplify-prefect-workflow-creation" target="_blank" rel="noopener noreferrer">Prefect</a>, and <a href="https://github.com/outerbounds/hamilton-metaflow" target="_blank" rel="noopener noreferrer">Metaflow</a>.</li>
<li>You need to gain visibility over production systems failures → look into Hamilton’s data quality capabilities, and other monitoring tools like <a href="http://www.dagworks.io" target="_blank" rel="noopener noreferrer">DAGWorks</a>.</li>
<li>You need to share results and collaborate with team members → look into experiment tracking platforms.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-words">Final words<a href="#final-words" class="hash-link" aria-label="Direct link to Final words" title="Direct link to Final words">​</a></h2>
<p>Having Hamilton + Feast in your stack will quickly feel natural. Together, they improve operational efficiency by enabling you to standardize &amp; centralize feature transformations, feature registration, storage and retrieval. So not only will teams be able to create training sets from each others’ features, they will also be able to trace what data produced it and how it was transformed to more easily trust and mitigate data issues. Altogether this will mean that teams will move faster with more confidence.</p>
<p>Simply fork the example <a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/feast" target="_blank" rel="noopener noreferrer">repository for Feast + Hamilton</a> to get started! It will give you an idea how to: structure your directory, write Hamilton data transformations, define Feast objects, and retrieve features from Feast.</p>
<p>For users who have questions on the above, please reach out to us on Slack! We’re also more than happy to consult on Feast matters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="links">Links<a href="#links" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h2>
<p>🔗 Join our community on <a href="https://hamilton-opensource.slack.com/join/shared_invite/zt-1bjs72asx-wcUTgH7q7QX1igiQ5bbdcg#/shared-invite/email" target="_blank" rel="noopener noreferrer">Slack</a>.</p>
<p>⭐️ Leave us a star on <a href="https://github.com/DAGWorks-Inc/hamilton" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
<p>⌨️ Try Hamilton in the browser at <a href="https://tryhamilton.dev" target="_blank" rel="noopener noreferrer">tryhamilton.dev</a>.</p>
<p>Integrate Feast and Hamilton: example <a href="https://github.com/DAGWorks-Inc/hamilton/tree/main/examples/feast" target="_blank" rel="noopener noreferrer">GitHub repository</a>.</p>
<p>Read: <a href="https://blog.dagworks.io/p/tidy-production-pandas-with-hamilton-3b759a2bf562" target="_blank" rel="noopener noreferrer">Writing tidy production Pandas code with Hamilton</a> .</p>
<p>Read: <a href="https://madewithml.com/courses/mlops/feature-store/#when-do-i-need-a-feature-store" target="_blank" rel="noopener noreferrer">An hands-on and succinct introduction to feature stores and Feast by MadeWithML</a>.</p>
<p>Integrate Hamilton with your favorite macro-orchestrator: <a href="https://blog.dagworks.io/publish/post/130538397" target="_blank" rel="noopener noreferrer">Airflow</a>, <a href="https://substack.com/inbox/post/135342200" target="_blank" rel="noopener noreferrer">Prefect</a>, <a href="https://outerbounds.com/blog/developing-scalable-feature-engineering-dags/" target="_blank" rel="noopener noreferrer">Metaflow</a>.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/hamilton">Hamilton</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/feast">Feast</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/personal_website/blog/tags/feature-store">feature store</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/personal_website/blog/pdf-summarizer"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Containerized PDF Summarizer with FastAPI and Hamilton</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/personal_website/blog/prefect-hamilton"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Simplify Prefect Workflow Creation and Maintenance with Hamilton</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-problem-does-feast-solve" class="table-of-contents__link toc-highlight">What problem does Feast solve?</a></li><li><a href="#what-is-feast" class="table-of-contents__link toc-highlight">What is Feast?</a></li><li><a href="#more-on-feature-computation-and-lineage" class="table-of-contents__link toc-highlight">More on feature computation and lineage</a></li><li><a href="#how-can-hamilton-help" class="table-of-contents__link toc-highlight">How can Hamilton help?</a><ul><li><a href="#1-use-hamilton-for-data-transformations-before-pushing-to-feast" class="table-of-contents__link toc-highlight">1. Use Hamilton for data transformations before pushing to Feast</a></li><li><a href="#2-use-hamilton-to-wrangle-feast-definitions" class="table-of-contents__link toc-highlight">2. Use Hamilton to wrangle Feast definitions</a></li></ul></li><li><a href="#the-full-hamilton--feast-experience" class="table-of-contents__link toc-highlight">The full Hamilton + Feast experience</a></li><li><a href="#build-the-feature-platform-you-need" class="table-of-contents__link toc-highlight">Build the feature platform you need</a><ul><li><a href="#step-1-adopt-hamilton" class="table-of-contents__link toc-highlight">Step 1: Adopt Hamilton</a></li><li><a href="#step-2-feature-store" class="table-of-contents__link toc-highlight">Step 2: Feature Store?</a></li></ul></li><li><a href="#some-illustrative-scenarios" class="table-of-contents__link toc-highlight">Some Illustrative scenarios</a><ul><li><a href="#you-are-just-getting-started-with-data-science-and-machine-learning-and-writing-a-proof-of-concepts" class="table-of-contents__link toc-highlight">You are just getting started with data science and machine learning and writing a proof of concept(s).</a></li><li><a href="#you-are-managing-a-few-deployed-projects-serving-predictions-to-users" class="table-of-contents__link toc-highlight">You are managing a few deployed projects serving predictions to users.</a></li><li><a href="#you-have-multiple-mature-projects-serving-a-large-number-of-predictions" class="table-of-contents__link toc-highlight">You have multiple mature projects serving a large number of predictions.</a></li></ul></li><li><a href="#you-decided-to-migrate-to-feast" class="table-of-contents__link toc-highlight">You decided to migrate to Feast</a></li><li><a href="#you-decided-not-to-migrateadopt-to-feast-yet" class="table-of-contents__link toc-highlight">You decided not to migrate/adopt to Feast (yet?)</a></li><li><a href="#final-words" class="table-of-contents__link toc-highlight">Final words</a></li><li><a href="#links" class="table-of-contents__link toc-highlight">Links</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© Copyright 2024, Thierry Jean. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>